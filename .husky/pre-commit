echo "Running pre-commit checks..."
npm run format

# # # Lint the codebase to ensure code quality
echo "Linting the codebase..."
npm run lint

# # Install dependencies in CI mode to ensure a clean state
# npm ci --prefer-offline --no-audit --no-fund

# # # Run the test-percentage check script. If it exits non-zero, push is blocked.
# # node scripts/check-tests-percentage.js || {
# #   echo "Pre-push check failed: test pass percentage below required threshold."
# #   exit 1
# # }

echo "Running tests..."
# npm test

# node scripts/check-tests-percentage.js || {
#   echo "Pre-push check failed: test pass percentage below required threshold."
#   exit 1
# }

#!/bin/sh

#!/usr/bin/env bash
# ...existing code...
echo "Running coverage check..."
OUT="$(mktemp)"
npm run coverage:check 2>&1 | tee "$OUT"
RC=${PIPESTATUS[0]}
# print first occurrence of each metric (Statements/Branches/Functions/Lines)
grep -E 'Statements|Branches|Functions|Lines' "$OUT" | awk '!seen[$1]++' | sed 's/^[[:space:]]*//'
rm -f "$OUT"
if [ $RC -ne 0 ]; then
  echo "❌ Coverage below required thresholds — commit blocked"
  exit 1
fi
echo "✅ Coverage OK"
# ...existing code...



echo "Checking for unused files/dependencies..."
# npm run knip

# Run knip LAST because it is the slowest and most likely to fail
# npm run knip || {
#   echo "Knip check failed: unused files/exports/deps detected."
#   exit 1
# }