echo "Running pre-commit checks..."
npm run format

# # # Lint the codebase to ensure code quality
echo "Linting the codebase..."
npm run lint

# # Install dependencies in CI mode to ensure a clean state
# npm ci --prefer-offline --no-audit --no-fund

# # # Run the test-percentage check script. If it exits non-zero, push is blocked.
# # node scripts/check-tests-percentage.js || {
# #   echo "Pre-push check failed: test pass percentage below required threshold."
# #   exit 1
# # }

echo "Running tests..."
npm test

# node scripts/check-tests-percentage.js || {
#   echo "Pre-push check failed: test pass percentage below required threshold."
#   exit 1
# }

#!/bin/sh

# Run tests → get the "All files" row → extract 4 columns → check each ≥ 90
npx nyc --reporter=text mocha --recursive --exit \
  | grep -E "^\s*All files" \
  | awk '{print $3,$4,$5,$6}' \
  | tr -d '%' \
  | awk '{exit !($1>=90 && $2>=90 && $3>=90 && $4>=90)}' \
  || { echo "❌ Coverage below 90% — push blocked"; exit 1; }

echo "✅ Coverage OK — push allowed"


echo "Checking for unused files/dependencies..."
npm run knip

# Run knip LAST because it is the slowest and most likely to fail
# npm run knip || {
#   echo "Knip check failed: unused files/exports/deps detected."
#   exit 1
# }